{"ast":null,"code":"import _objectSpread from\"C:/Users/PERSONAL/Downloads/tugood tugo/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useNavigate}from'react-router-dom';import{Eye,EyeOff,Mail,Lock,User,Phone,MapPin}from'lucide-react';import{authAPI}from'../services/api';import'../styles/LoginScreen.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const LoginScreen=_ref=>{let{onLogin}=_ref;const navigate=useNavigate();const[isLogin,setIsLogin]=useState(true);const[showPassword,setShowPassword]=useState(false);const[loading,setLoading]=useState(false);const[error,setError]=useState('');// Form data\nconst[formData,setFormData]=useState({email:'',password:'',nombre:'',telefono:'',tipo:'cliente'// 'cliente' o 'comercio'\n});const handleInputChange=e=>{setFormData(_objectSpread(_objectSpread({},formData),{},{[e.target.name]:e.target.value}));setError('');// Clear error when user types\n};const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{let result;if(isLogin){console.log('Iniciando sesión con:',formData.email);result=await authAPI.login({email:formData.email,password:formData.password});console.log('Respuesta de login:',result);// Verificar que el token se haya guardado correctamente\nconst token=localStorage.getItem('tugood_token');if(!token){throw new Error('No se pudo obtener el token de autenticación');}console.log('Token guardado correctamente');}else{console.log('Registrando nuevo usuario:',formData.email);const userData={nombre:formData.nombre,telefono:formData.telefono,email:formData.email,password:formData.password,tipo:formData.tipo||'cliente'};result=await authAPI.register(userData);console.log('Usuario registrado:',result);}// Verificar si requiere verificación por email\nif(result.requiresVerification){var _result$emailResult,_result$emailResult2;console.log('Redirigiendo a verificación de email');navigate('/email-verification',{state:{email:((_result$emailResult=result.emailResult)===null||_result$emailResult===void 0?void 0:_result$emailResult.email)||formData.email,type:((_result$emailResult2=result.emailResult)===null||_result$emailResult2===void 0?void 0:_result$emailResult2.type)||(isLogin?'login':'registration'),userData:result.user}});return;}// Usar el usuario devuelto por la respuesta directamente\nconst currentUser=result.user;console.log('Usuario autenticado:',currentUser);if(!currentUser){throw new Error('No se pudo obtener la información del usuario');}// Call onLogin with the user data\nif(onLogin){onLogin(currentUser);}}catch(err){console.error('Login/Register error:',err);// Handle specific error messages\nif(err.message&&err.message.includes(\"ya está registrado\")){setError(\"Este correo ya está registrado. Prueba con otro o inicia sesión.\");}else if(err.message&&err.message.includes(\"Credenciales inválidas\")){setError(\"Correo o contraseña incorrectos. Verifica tus datos.\");}else if(err.message&&err.message.includes(\"Usuario no encontrado\")){setError(\"No existe una cuenta con este correo. ¿Quieres registrarte?\");}else{setError(err.message||'Error en el proceso de autenticación');}}finally{setLoading(false);}};const handleGoogleLogin=async()=>{setError('Función de Google Login próximamente disponible');};const handleDemoLogin=async()=>{setLoading(true);setError('');try{console.log('Iniciando sesión demo...');const result=await authAPI.login({email:'demo@tugood.com',password:'demo123'});console.log('Login demo exitoso:',result);// Verificar que el token se haya guardado\nconst token=localStorage.getItem('tugood_token');if(!token){throw new Error('No se pudo obtener el token de autenticación');}// Usar el usuario devuelto por la respuesta del login\nconst currentUser=result.user;console.log('Usuario demo autenticado:',currentUser);if(!currentUser){throw new Error('No se pudo obtener la información del usuario demo');}if(onLogin){onLogin(currentUser);}}catch(err){console.error('Error en login demo:',err);setError(err.message||'Error en el login demo. Intenta iniciar sesión manualmente.');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"login-screen\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"login-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"login-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"logo\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"TuGood TuGo\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Rescata comida, ahorra dinero\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth-toggle\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(isLogin?'active':''),onClick:()=>{setIsLogin(true);setError('');setFormData(_objectSpread(_objectSpread({},formData),{},{nombre:'',telefono:'',tipo:'cliente'}));},children:\"Iniciar Sesi\\xF3n\"}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(!isLogin?'active':''),onClick:()=>{setIsLogin(false);setError('');},children:\"Registrarse\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"auth-form\",children:[!isLogin&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"input-icon-emoji\",children:\"\\uD83D\\uDC64\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"nombre\",placeholder:\"Nombre completo\",value:formData.nombre,onChange:handleInputChange,required:true,autoComplete:\"name\",style:{color:'#000000 !important',WebkitTextFillColor:'#000000 !important',backgroundColor:'#ffffff !important'}})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"input-icon-emoji\",children:\"\\uD83D\\uDCF1\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"telefono\",placeholder:\"Telefono (ej: 3001234567)\",value:formData.telefono,onChange:handleInputChange,required:true,autoComplete:\"tel\",style:{color:'#000000 !important',WebkitTextFillColor:'#000000 !important',backgroundColor:'#ffffff !important'}})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"form-label\",children:\"Tipo de cuenta: (\\xBFEres cliente o comercio?)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"radio-group\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"radio-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"tipo\",value:\"cliente\",checked:formData.tipo==='cliente',onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{className:\"radio-custom\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"radio-content\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDED2 Cliente\"}),/*#__PURE__*/_jsx(\"small\",{children:\"Comprar packs de comida\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"radio-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"tipo\",value:\"comercio\",checked:formData.tipo==='comercio',onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{className:\"radio-custom\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"radio-content\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83C\\uDFEA Comercio\"}),/*#__PURE__*/_jsx(\"small\",{children:\"Vender excedentes de comida\"})]})]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"input-icon-emoji\",children:\"\\uD83D\\uDCE7\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",placeholder:\"Email\",value:formData.email,onChange:handleInputChange,required:true,autoComplete:\"email\",style:{color:'#000000 !important',WebkitTextFillColor:'#000000 !important',backgroundColor:'#ffffff !important'}})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"input-wrapper\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"input-icon-emoji\",children:\"\\uD83D\\uDD12\"}),/*#__PURE__*/_jsx(\"input\",{type:showPassword?'text':'password',name:\"password\",placeholder:\"Password\",value:formData.password,onChange:handleInputChange,required:true,minLength:6,autoComplete:isLogin?\"current-password\":\"new-password\",style:{color:'#000000 !important',WebkitTextFillColor:'#000000 !important',backgroundColor:'#ffffff !important'}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"password-toggle\",onClick:()=>setShowPassword(!showPassword),children:showPassword?/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDE48\"}):/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC41\\uFE0F\"})})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u26A0\\uFE0F \",error]})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"submit-btn\",disabled:loading,children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner small\"}):isLogin?'Iniciar Sesión':'Crear Cuenta'}),/*#__PURE__*/_jsx(\"div\",{className:\"divider\",children:/*#__PURE__*/_jsx(\"span\",{children:\"o\"})}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"google-btn\",onClick:handleGoogleLogin,disabled:loading,children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://developers.google.com/identity/images/g-logo.png\",alt:\"Google\",width:\"20\",height:\"20\"}),\"Continuar con Google\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"auth-footer\",children:isLogin?/*#__PURE__*/_jsxs(\"p\",{children:[\"\\xBFNo tienes cuenta?\",' ',/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"link-btn\",onClick:()=>setIsLogin(false),children:\"Reg\\xEDstrate aqu\\xED\"})]}):/*#__PURE__*/_jsxs(\"p\",{children:[\"\\xBFYa tienes cuenta?\",' ',/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"link-btn\",onClick:()=>setIsLogin(true),children:\"Inicia sesi\\xF3n\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"demo-accounts\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Cuentas de prueba:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"demo-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"demo-btn\",onClick:handleDemoLogin,children:\"Cliente Demo\"}),/*#__PURE__*/_jsx(\"button\",{className:\"demo-btn\",onClick:()=>setFormData(_objectSpread(_objectSpread({},formData),{},{email:'panaderia@test.com',password:'test123'})),children:\"Comercio Demo\"})]})]})]})});};export default LoginScreen;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}