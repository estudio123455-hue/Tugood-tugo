{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{ArrowLeft,MapPin,Clock,Star,Heart,ShoppingCart}from'lucide-react';import{packsAPI,usersAPI}from'../services/api';import'../styles/OfferDetail.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const OfferDetail=_ref=>{let{user,onReserve}=_ref;const{offerId}=useParams();const navigate=useNavigate();const[isFavorite,setIsFavorite]=useState(false);const[currentImageIndex,setCurrentImageIndex]=useState(0);const[offer,setOffer]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[reserving,setReserving]=useState(false);// Load pack data from API\nuseEffect(()=>{const loadOffer=async()=>{try{setLoading(true);const packData=await packsAPI.getById(offerId);// Transform pack data to offer format\nconst transformedOffer={id:packData.pack.id,businessId:packData.pack.comercio_id,businessName:packData.pack.comercio_nombre,businessType:packData.pack.comercio_tipo||'Comercio',rating:packData.pack.comercio_rating||4.0,reviewCount:127,images:[\"https://picsum.photos/400/300?random=\".concat(packData.pack.id,\"1\"),\"https://picsum.photos/400/300?random=\".concat(packData.pack.id,\"2\"),\"https://picsum.photos/400/300?random=\".concat(packData.pack.id,\"3\")],title:packData.pack.nombre,description:packData.pack.descripcion,originalPrice:packData.pack.precio_original,discountedPrice:packData.pack.precio_oferta,discount:Math.round((packData.pack.precio_original-packData.pack.precio_oferta)/packData.pack.precio_original*100),pickupTimeStart:'12:00',pickupTimeEnd:'14:00',address:packData.pack.comercio_direccion||'Bogotá, Colombia',coordinates:{lat:4.6097,lng:-74.0817},availableQuantity:packData.pack.cantidad_disponible||5,distance:'0.8 km'};setOffer(transformedOffer);}catch(err){console.error('Error loading offer:',err);setError('Error cargando la oferta');}finally{setLoading(false);}};loadOffer();},[offerId]);const handleReserve=async()=>{try{setReserving(true);// Add to cart in localStorage for now\nconst cart=JSON.parse(localStorage.getItem('tugood_cart')||'[]');const existingItem=cart.find(item=>item.id===offer.id);if(existingItem){existingItem.quantity+=1;}else{var _offer$images;cart.push({id:offer.id,name:offer.title,businessName:offer.businessName,businessId:offer.businessId,price:offer.discountedPrice,originalPrice:offer.originalPrice,image:((_offer$images=offer.images)===null||_offer$images===void 0?void 0:_offer$images[0])||'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=300&h=200&fit=crop',quantity:1,pickupTime:\"\".concat(offer.pickupTimeStart||'12:00',\" - \").concat(offer.pickupTimeEnd||'14:00'),address:offer.address||'Dirección no disponible'});}localStorage.setItem('tugood_cart',JSON.stringify(cart));// Show success feedback\nalert('¡Producto agregado al carrito!');if(onReserve){onReserve(offer);}// Navigate to cart after a brief delay\nsetTimeout(()=>{navigate('/cart');},500);}catch(err){console.error('Error adding to cart:',err);alert('Error al agregar al carrito');}finally{setReserving(false);}};const handleToggleFavorite=async()=>{try{// TODO: Implement favorites API call\nsetIsFavorite(!isFavorite);}catch(err){console.error('Error toggling favorite:',err);}};const nextImage=()=>{setCurrentImageIndex(prev=>prev===offer.images.length-1?0:prev+1);};const prevImage=()=>{setCurrentImageIndex(prev=>prev===0?offer.images.length-1:prev-1);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"offer-detail\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Cargando oferta...\"})]})});}if(error||!offer){return/*#__PURE__*/_jsx(\"div\",{className:\"offer-detail\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-container\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error||'Oferta no encontrada'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),children:\"Volver\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"offer-detail\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"offer-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:()=>navigate(-1),children:/*#__PURE__*/_jsx(ArrowLeft,{size:24})}),/*#__PURE__*/_jsx(\"button\",{className:\"favorite-button \".concat(isFavorite?'active':''),onClick:handleToggleFavorite,children:/*#__PURE__*/_jsx(Heart,{size:24,fill:isFavorite?'#ff6b6b':'none'})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"image-carousel\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"image-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:offer.images[currentImageIndex],alt:\"\".concat(offer.title,\" - Imagen \").concat(currentImageIndex+1),className:\"offer-image\"}),offer.images.length>1&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"carousel-button prev\",onClick:prevImage,children:\"\\u2039\"}),/*#__PURE__*/_jsx(\"button\",{className:\"carousel-button next\",onClick:nextImage,children:\"\\u203A\"}),/*#__PURE__*/_jsx(\"div\",{className:\"image-indicators\",children:offer.images.map((_,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"indicator \".concat(index===currentImageIndex?'active':''),onClick:()=>setCurrentImageIndex(index)},index))})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"offer-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"business-info\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"business-header\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"business-name\",children:offer.businessName}),/*#__PURE__*/_jsxs(\"div\",{className:\"business-meta\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"business-type\",children:offer.businessType}),/*#__PURE__*/_jsxs(\"div\",{className:\"rating\",children:[/*#__PURE__*/_jsx(Star,{size:16,fill:\"#ffd700\",color:\"#ffd700\"}),/*#__PURE__*/_jsx(\"span\",{children:offer.rating}),/*#__PURE__*/_jsxs(\"span\",{className:\"review-count\",children:[\"(\",offer.reviewCount,\")\"]})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"offer-info\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"offer-title\",children:offer.title}),/*#__PURE__*/_jsx(\"p\",{className:\"offer-description\",children:offer.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"pricing\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"price-container\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"original-price\",children:[\"$\",(offer.originalPrice*4000).toLocaleString(),\" COP\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"discounted-price\",children:[\"$\",(offer.discountedPrice*4000).toLocaleString(),\" COP\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"discount-badge\",children:[\"-\",offer.discount,\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pickup-info\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(Clock,{size:20}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Horario de Recogida\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Hoy, \",offer.pickupTimeStart,\" - \",offer.pickupTimeEnd]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"location-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(MapPin,{size:20}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ubicaci\\xF3n\"}),/*#__PURE__*/_jsx(\"p\",{children:offer.address}),/*#__PURE__*/_jsxs(\"span\",{className:\"distance\",children:[offer.distance,\" de distancia\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"map-placeholder\",children:/*#__PURE__*/_jsx(\"div\",{className:\"map-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-mock\",children:[/*#__PURE__*/_jsx(MapPin,{size:32}),/*#__PURE__*/_jsx(\"p\",{children:\"Mapa interactivo\"})]})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"availability\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"quantity-left\",children:[offer.availableQuantity,\" pack\",offer.availableQuantity!==1?'s':'',\" disponible\",offer.availableQuantity!==1?'s':'']})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"reserve-section\",children:/*#__PURE__*/_jsx(\"button\",{className:\"reserve-button\",onClick:handleReserve,disabled:offer.availableQuantity===0||reserving,children:reserving?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner small\"}),\"Agregando...\"]}):offer.availableQuantity>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ShoppingCart,{size:20}),\"Agregar al Carrito\"]}):'Agotado'})})]});};export default OfferDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}