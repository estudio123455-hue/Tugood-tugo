{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{CheckCircle,AlertCircle,Clock,Package,MapPin,Phone,User,DollarSign,Shield,ArrowLeft,ExternalLink}from'lucide-react';import{decodeQRData,isValidQR,getQRTimeRemaining}from'../utils/qrUtils';import'../styles/OrderVerification.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const OrderVerification=()=>{const{encodedData}=useParams();const navigate=useNavigate();const[qrData,setQrData]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[confirming,setConfirming]=useState(false);const[confirmed,setConfirmed]=useState(false);useEffect(()=>{if(encodedData){try{const decoded=decodeQRData(encodedData);if(decoded){setQrData(decoded);// Verificar si el QR es válido\nif(!isValidQR(decoded)){setError('Este código QR ha expirado');}}else{setError('Código QR inválido');}}catch(err){setError('Error al procesar el código QR');}}else{setError('No se proporcionó código de verificación');}setLoading(false);},[encodedData]);const handleConfirmDelivery=async()=>{if(!qrData)return;setConfirming(true);try{// Simular llamada a API para confirmar entrega\nawait new Promise(resolve=>setTimeout(resolve,2000));// En una implementación real, aquí iría la llamada al backend:\n// await api.confirmarEntrega({\n//   pedidoId: qrData.pedidoId,\n//   codigoSeguridad: qrData.codigo,\n//   token: qrData.token,\n//   fechaEntrega: new Date().toISOString()\n// });\nsetConfirmed(true);// Auto-cerrar después de 5 segundos\nsetTimeout(()=>{window.close();},5000);}catch(err){setError('Error al confirmar la entrega');}finally{setConfirming(false);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"verification-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"verification-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Verificando c\\xF3digo QR...\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Por favor espera un momento\"})]})})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"verification-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"verification-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-state\",children:[/*#__PURE__*/_jsx(AlertCircle,{size:64,className:\"error-icon\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Error de Verificaci\\xF3n\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>window.close(),children:\"Cerrar\"})]})})});}if(confirmed){return/*#__PURE__*/_jsx(\"div\",{className:\"verification-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"verification-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"success-state\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"success-animation\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:80,className:\"success-icon\"}),/*#__PURE__*/_jsx(\"div\",{className:\"success-ring\"})]}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\xA1Entrega Confirmada!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"El pedido ha sido entregado exitosamente\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"success-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(Package,{size:16}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Pedido #\",qrData.pedidoId]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(Clock,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:new Date().toLocaleString('es-CO')})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"auto-close-text\",children:\"Esta ventana se cerrar\\xE1 autom\\xE1ticamente en 5 segundos\"})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"verification-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"verification-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"verification-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"brand-section\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDED2 TuGood TuGo\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Verificaci\\xF3n de Pedido\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-badge valid\",children:[/*#__PURE__*/_jsx(Shield,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"Pedido Verificado\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Detalles del Pedido\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-id\",children:[\"#\",qrData.pedidoId]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"details-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-icon\",children:/*#__PURE__*/_jsx(User,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Cliente\"}),/*#__PURE__*/_jsx(\"p\",{children:qrData.cliente})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-icon\",children:/*#__PURE__*/_jsx(Package,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Comercio\"}),/*#__PURE__*/_jsx(\"p\",{children:qrData.comercio})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-icon\",children:/*#__PURE__*/_jsx(DollarSign,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Total\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"$\",qrData.total.toLocaleString(),\" COP\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-icon\",children:/*#__PURE__*/_jsx(Package,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Art\\xEDculos\"}),/*#__PURE__*/_jsxs(\"p\",{children:[qrData.items,\" paquete\",qrData.items>1?'s':'']})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"security-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"security-header\",children:[/*#__PURE__*/_jsx(Shield,{size:20}),/*#__PURE__*/_jsx(\"h3\",{children:\"C\\xF3digo de Seguridad\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"security-code\",children:qrData.codigo}),/*#__PURE__*/_jsx(\"p\",{className:\"security-note\",children:\"Verifica que este c\\xF3digo coincida con el mostrado por el cliente\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"contact-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"contact-item\",children:[/*#__PURE__*/_jsx(MapPin,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:qrData.direccion})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"contact-item\",children:[/*#__PURE__*/_jsx(Phone,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:qrData.telefono})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"validity-info\",children:[/*#__PURE__*/_jsx(Clock,{size:16}),/*#__PURE__*/_jsxs(\"span\",{children:[\"V\\xE1lido por: \",getQRTimeRemaining(qrData)]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"instructions\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCB Instrucciones de Entrega\"}),/*#__PURE__*/_jsxs(\"ol\",{children:[/*#__PURE__*/_jsx(\"li\",{children:\"Verifica que el c\\xF3digo de seguridad coincida\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Confirma la identidad del cliente\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Entrega el pedido al cliente\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Haz clic en \\\"Confirmar Entrega\\\" abajo\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"verification-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary btn-large\",onClick:handleConfirmDelivery,disabled:confirming,children:confirming?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"btn-spinner\"}),\"Confirmando...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CheckCircle,{size:20}),\"Confirmar Entrega\"]})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>window.close(),children:\"Cancelar\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"verification-footer\",children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(ExternalLink,{size:14}),\"Powered by TuGood TuGo - Sistema de Verificaci\\xF3n Segura\"]})})]})});};export default OrderVerification;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}