{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{ArrowLeft,Clock,MapPin,CheckCircle,Package}from'lucide-react';import{pedidosAPI}from'../services/api';import'../styles/MyOrders.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MyOrders=_ref=>{let{user}=_ref;const navigate=useNavigate();const[activeTab,setActiveTab]=useState('active');const[activeOrders,setActiveOrders]=useState([]);const[orderHistory,setOrderHistory]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Load orders from API\nuseEffect(()=>{const loadOrders=async()=>{try{setLoading(true);setError(null);// Get user ID from props or localStorage\nconst userId=(user===null||user===void 0?void 0:user.id)||localStorage.getItem('userId');if(!userId){const errorMsg='No se encontró el ID de usuario';console.warn(errorMsg);setError(errorMsg);setLoading(false);return;}console.log(\"Cargando pedidos para usuario: \".concat(userId));const orders=await pedidosAPI.getAll();// Log para depuración\nconsole.log('Respuesta de la API:',{ordersCount:orders.length,sampleOrder:orders[0]||'No hay pedidos'});// Separar pedidos activos e historial\nconst active=orders.filter(order=>order.estado==='confirmado'||order.estado==='listo');const completed=orders.filter(order=>order.estado==='completado'||order.estado==='cancelado');setActiveOrders(active);setOrderHistory(completed);if(orders.length===0){console.log('No se encontraron pedidos para el usuario');}}catch(err){console.error('Error al cargar pedidos:',err);setError('No se pudieron cargar los pedidos. Por favor, inténtalo de nuevo.');}finally{setLoading(false);}};loadOrders();},[user===null||user===void 0?void 0:user.id]);// Add user.id to dependency array\nconst getStatusColor=status=>{switch(status){case'confirmado':return'#fbbf24';case'listo':return'#10b981';case'completado':return'#6b7280';case'cancelado':return'#ef4444';default:return'#6b7280';}};const getStatusText=status=>{switch(status){case'confirmado':return'Confirmado';case'listo':return'Listo para recoger';case'completado':return'Completado';case'cancelado':return'Cancelado';default:return status;}};const getStatusIcon=status=>{switch(status){case'confirmado':return/*#__PURE__*/_jsx(Clock,{size:16});case'listo':return/*#__PURE__*/_jsx(Package,{size:16});case'completado':return/*#__PURE__*/_jsx(CheckCircle,{size:16});case'cancelado':return/*#__PURE__*/_jsx(CheckCircle,{size:16});default:return/*#__PURE__*/_jsx(Clock,{size:16});}};const OrderCard=_ref2=>{let{order}=_ref2;return/*#__PURE__*/_jsxs(\"div\",{className:\"order-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"order-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:order.comercio_nombre}),/*#__PURE__*/_jsx(\"p\",{children:order.pack_titulo})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-status\",style:{color:getStatusColor(order.estado)},children:[getStatusIcon(order.estado),/*#__PURE__*/_jsx(\"span\",{children:getStatusText(order.estado)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(Clock,{size:16}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Recogida: \",order.hora_recogida_inicio,\" - \",order.hora_recogida_fin]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(MapPin,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:order.comercio_direccion})]}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-row\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"order-id\",children:[\"Pedido #\",order.id]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"order-footer\",children:/*#__PURE__*/_jsx(\"div\",{className:\"order-total\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"Total: $\",order.total.toLocaleString(),\" COP\"]})})})]});};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"orders-screen\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Cargando pedidos...\"})]})})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"orders-screen\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-container\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),children:\"Reintentar\"})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"orders-screen\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"orders-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:()=>navigate(-1),children:/*#__PURE__*/_jsx(ArrowLeft,{size:24})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Pedidos\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"orders-tabs\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"tab-button \".concat(activeTab==='active'?'active':''),onClick:()=>setActiveTab('active'),children:[\"Activos (\",activeOrders.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"tab-button \".concat(activeTab==='history'?'active':''),onClick:()=>setActiveTab('history'),children:[\"Historial (\",orderHistory.length,\")\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"orders-content\",children:activeTab==='active'?/*#__PURE__*/_jsx(\"div\",{className:\"active-orders\",children:activeOrders.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Pedidos Activos\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Tus pedidos confirmados y listos para recoger\"})]}),activeOrders.map(order=>/*#__PURE__*/_jsx(OrderCard,{order:order},order.id))]}):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(Package,{size:64}),/*#__PURE__*/_jsx(\"h3\",{children:\"No tienes pedidos activos\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Cuando hagas una reserva, aparecer\\xE1 aqu\\xED\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>navigate('/main'),children:\"Explorar ofertas\"})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"order-history\",children:orderHistory.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Historial de Pedidos\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Tus pedidos completados\"})]}),orderHistory.map(order=>/*#__PURE__*/_jsx(OrderCard,{order:order},order.id))]}):/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:64}),/*#__PURE__*/_jsx(\"h3\",{children:\"No tienes pedidos completados\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Tu historial de pedidos aparecer\\xE1 aqu\\xED\"})]})})})]})});};export default MyOrders;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}