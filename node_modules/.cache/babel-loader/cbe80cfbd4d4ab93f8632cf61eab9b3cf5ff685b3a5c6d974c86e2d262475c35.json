{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import{ArrowLeft,Mail,Shield,RefreshCw,CheckCircle,AlertCircle}from'lucide-react';import{verifyConfirmationCode,sendRegistrationConfirmation,sendLoginConfirmation}from'../services/emailService';import'../styles/EmailVerification.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const EmailVerification=()=>{const navigate=useNavigate();const location=useLocation();const[code,setCode]=useState(['','','','','','']);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[resending,setResending]=useState(false);const[timeLeft,setTimeLeft]=useState(300);// 5 minutos\nconst[verified,setVerified]=useState(false);// Obtener datos del estado de navegación\nconst{email,type,userData}=location.state||{};useEffect(()=>{// Redirigir si no hay datos\nif(!email||!type){navigate('/login');return;}// Countdown timer\nconst timer=setInterval(()=>{setTimeLeft(prev=>{if(prev<=1){clearInterval(timer);return 0;}return prev-1;});},1000);return()=>clearInterval(timer);},[email,type,navigate]);const formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins,\":\").concat(secs.toString().padStart(2,'0'));};const handleCodeChange=(index,value)=>{if(value.length>1)return;// Solo un dígito\nconst newCode=[...code];newCode[index]=value;setCode(newCode);setError('');// Auto-focus al siguiente input\nif(value&&index<5){const nextInput=document.getElementById(\"code-\".concat(index+1));if(nextInput)nextInput.focus();}// Auto-verificar cuando se complete el código\nif(newCode.every(digit=>digit!=='')&&newCode.join('').length===6){handleVerifyCode(newCode.join(''));}};const handleKeyDown=(index,e)=>{// Backspace: ir al input anterior\nif(e.key==='Backspace'&&!code[index]&&index>0){const prevInput=document.getElementById(\"code-\".concat(index-1));if(prevInput)prevInput.focus();}};const handleVerifyCode=async function(){let codeToVerify=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;const verificationCode=codeToVerify||code.join('');if(verificationCode.length!==6){setError('Por favor ingresa el código completo de 6 dígitos');return;}setLoading(true);setError('');try{const isValid=verifyConfirmationCode(email,verificationCode,type);if(isValid){setVerified(true);// Mostrar éxito por 2 segundos antes de redirigir\nsetTimeout(()=>{if(type==='registration'){navigate('/location');// Ir a selección de ubicación después del registro\n}else{navigate('/main');// Ir a pantalla principal después del login\n}},2000);}else{setError('Código incorrecto. Por favor verifica e intenta nuevamente.');setCode(['','','','','','']);// Focus al primer input\nconst firstInput=document.getElementById('code-0');if(firstInput)firstInput.focus();}}catch(err){setError('Error verificando el código. Intenta nuevamente.');}finally{setLoading(false);}};const handleResendCode=async()=>{if(resending||timeLeft>240)return;// No permitir reenvío muy frecuente\nsetResending(true);setError('');try{let result;if(type==='registration'){result=await sendRegistrationConfirmation(userData);}else{result=await sendLoginConfirmation(userData);}if(result&&result.success!==false){setTimeLeft(300);// Reiniciar timer\nalert('📧 Nuevo código enviado a tu email');}else{setError('Error reenviando el código. Intenta más tarde.');}}catch(err){setError('Error reenviando el código. Intenta más tarde.');}finally{setResending(false);}};if(verified){return/*#__PURE__*/_jsx(\"div\",{className:\"email-verification\",children:/*#__PURE__*/_jsx(\"div\",{className:\"verification-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"success-state\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"success-animation\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:80,className:\"success-icon\"}),/*#__PURE__*/_jsx(\"div\",{className:\"success-ring\"})]}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\xA1Verificaci\\xF3n Exitosa!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Tu email ha sido confirmado correctamente\"}),/*#__PURE__*/_jsx(\"div\",{className:\"success-message\",children:type==='registration'?'Bienvenido a TuGood TuGo. Redirigiendo...':'Inicio de sesión confirmado. Redirigiendo...'})]})})});}return/*#__PURE__*/_jsx(\"div\",{className:\"email-verification\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"verification-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"verification-header\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-btn\",onClick:()=>navigate(-1),children:/*#__PURE__*/_jsx(ArrowLeft,{size:20})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Verificaci\\xF3n de Email\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"verification-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"email-icon\",children:/*#__PURE__*/_jsx(Mail,{size:64})}),/*#__PURE__*/_jsx(\"h2\",{children:\"Revisa tu email\"}),/*#__PURE__*/_jsx(\"p\",{className:\"verification-text\",children:\"Hemos enviado un c\\xF3digo de verificaci\\xF3n de 6 d\\xEDgitos a:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"email-display\",children:email}),/*#__PURE__*/_jsxs(\"div\",{className:\"code-input-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ingresa el c\\xF3digo de verificaci\\xF3n:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"code-inputs\",children:code.map((digit,index)=>/*#__PURE__*/_jsx(\"input\",{id:\"code-\".concat(index),type:\"text\",inputMode:\"numeric\",pattern:\"[0-9]*\",maxLength:\"1\",value:digit,onChange:e=>handleCodeChange(index,e.target.value.replace(/[^0-9]/g,'')),onKeyDown:e=>handleKeyDown(index,e),className:\"code-input \".concat(error?'error':''),disabled:loading},index))})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(AlertCircle,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:error})]}),/*#__PURE__*/_jsx(\"div\",{className:\"timer-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"timer\",children:[/*#__PURE__*/_jsx(Shield,{size:16}),/*#__PURE__*/_jsxs(\"span\",{children:[\"C\\xF3digo v\\xE1lido por: \",formatTime(timeLeft)]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"verification-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"verify-btn\",onClick:()=>handleVerifyCode(),disabled:loading||code.some(digit=>digit===''),children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"btn-spinner\"}),\"Verificando...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CheckCircle,{size:20}),\"Verificar C\\xF3digo\"]})}),/*#__PURE__*/_jsx(\"button\",{className:\"resend-btn\",onClick:handleResendCode,disabled:resending||timeLeft>240,children:resending?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"btn-spinner\"}),\"Reenviando...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(RefreshCw,{size:16}),timeLeft>240?\"Reenviar en \".concat(formatTime(timeLeft-240)):'Reenviar código']})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"help-text\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"\\xBFNo recibiste el email? Revisa tu carpeta de spam o correo no deseado.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Si sigues teniendo problemas, contacta a soporte@tugoodtugo.com\"})]})]})]})});};export default EmailVerification;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}